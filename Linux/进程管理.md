# 进程管理

## 基本概念

进程信息：进程的内存地址、进程当前的状态、进程正在使用的资源、进程的优先级、进程的属主。

进程的属性：PID, PPID, UID和EUID，GID和EGID，谦让度和优先级。

Linux中，应用程序只能通过克隆自己来产生新进程，因此，子进程是其父进程的克隆体。

进程的UID就是其创建者的ID号，用于标识进程的属主。

EUID，即有效用户ID号，这个特殊的UID号用来确定进程对某些资源和文件的访问权限。绝大部分情况下，进程的UID和EUID是一样的，除了setuid程序。

EGID是有效的组ID。GID就是其创建者所属组的ID号。

谦让度和优先级是一对相反的概念，高谦让度意味着低优先级。



## 监视进程：ps命令

```
$ ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.3 204912  7116 ?        Ss   Jan15   0:01 /sbin/init
root         2  0.0  0.0      0     0 ?        S    Jan15   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    Jan15   0:00 [ksoftirqd/0]
root         5  0.0  0.0      0     0 ?        S<   Jan15   0:00 [kworker/0:0H]
root         7  0.0  0.0      0     0 ?        S    Jan15   0:02 [rcu_sched]
root         8  0.0  0.0      0     0 ?        S    Jan15   0:00 [rcu_bh]
root         9  0.0  0.0      0     0 ?        S    Jan15   0:00 [migration/0]
```

其中，VSZ的含义是进程占用的虚拟内存大小。

RSS的含义是内存中页的数量（页是管理内存的单位，在PC上通常是4k）

TTY的含义是进程所在终端的ID号。

START 是进程启动的时间。

TIME是进程已经占用的CPU时间。

STAT是进程状态，常用字母的含义是：

| 字母   | 含义                    | 字母   | 含义                    |
| ---- | --------------------- | ---- | --------------------- |
| R    | 正在运行/可运行              | D    | 睡眠中（不可被唤醒，通常是在等待I/O设备 |
| S    | 睡眠中（可以被唤醒）            | T    | 停止（由于收到信号或被跟踪）        |
| Z    | 僵进程（已经结束儿没有释放系统资源的进程） | <    | 进程拥有比普通优先级高的优先级       |
| L    | 有些页面所在内存              | N    | 进程拥有比普通优先级低的优先级       |
| s    | 会话的先导进程               |      |                       |

ps的另一组选项是lax，可以提供父进程id PPID和谦让度NI，但不会显示进程属主的用户名，因此可以提供更快的运行速度。



## 即时跟踪进程信息：top

top命令用于即时跟踪当前系统中进程的情况。

top命令显示的信息会占满一页，在默认的情况下每10秒更新一次，CPU使用最多的程序会排在最前面，使用q退出这个监视程序。



## 查看占用文件的进程：lsof

lsof命令提供包括PID在内的各种进程信息，要找出占用某个文件的进程，需要提供文件名作为参数，不带参数的lsof命令回列出当前系统中所有打开文件的进程信息。



## 向进程发送信号：kill

kill命令向进程发送一个信号。使用kill -l命令显示所有信息及其编号。

经常用的信号名称和意义

| 信息编号 | 信号名  | 描述         | 默认情况下执行的操作 |
| ---- | ---- | ---------- | ---------- |
| 0    | EXIT | 程序退出时受到该信号 | 终止         |
| 1    | HUP  | 挂起         | 终止         |
| 2    | INT  | 中断         | 终止         |
| 3    | QUIT | 退出         | 终止         |
| 9    | KILL | 杀死         | 终止         |
| 11   | SEGV | 段错误        | 终止         |
| 15   | TERM | 软件终止       | 终止         |

默认情况下，kill命令向进程发送TERM信号，这个信号表示请求终止某项操作。

kill -9 pid 是强杀进程。



## 谦让度：nice 和renice

nice命令可以在启动程序时设置其谦让度。谦让度的值在-20~+19之间浮动。也就是说，nice命令启动程序，同时设置了谦让度值。

nice命令接受 -n参数增加程序的谦让度值，可以使用ps lax命令查看其谦让度值。nice命令将-n参数后面的数值加上默认谦让度值（默认为0）。

renice命令可以在进程运行时调整期谦让度值，调整的是绝对谦让度值。



## /proc 文件系统

/proc目录下存放着内核有关系统状态的各种有意义的信息。在系统运行的时候，内核回随时向这个目录写入数据。ps和top目录就是从这个地方读取数据的。这是操作系统向用户提供的一条通往内核的通道。

用户可以通过向/proc目录下的文件写入数据来修改操作系统参数。

```
root@kali:~# ls /proc/
1     1120  1210  1289  1367  16    211   2675  339  495  8    919  97         diskstats    keys         mtrr           sysvipc
10    1125  1215  1298  137   160   22    27    34   5    869  92   98         dma          key-users    net            thread-self
1035  1144  1220  1299  138   1608  23    275   35   535  88   920  99         driver       kmsg         pagetypeinfo   timer_list
1042  1151  1230  13    139   161   24    28    357  537  882  925  acpi       execdomains  kpagecgroup  partitions     timer_stats
1045  1156  1242  1302  1390  1614  247   289   45   543  887  93   asound     fb           kpagecount   sched_debug    tty
1046  1158  1250  1318  14    1698  2544  29    47   659  89   937  buddyinfo  filesystems  kpageflags   schedstat      uptime
1050  1173  1254  1323  140   18    257   3     472  694  9    94   bus        fs           loadavg      self           version
1051  1176  1259  133   1400  19    2599  30    473  7    90   941  cgroups    interrupts   locks        slabinfo       vmallocinfo
1056  1181  1264  1334  1403  2     26    308   474  701  901  945  cmdline    iomem        meminfo      softirqs       vmstat
1059  1194  1282  1335  1423  20    2601  31    478  705  906  95   consoles   ioports      misc         stat           zoneinfo
1061  12    1283  134   1466  2067  2644  314   484  706  91   96   cpuinfo    irq          modules      swaps
1068  1201  1285  135   15    21    2652  32    487  710  911  966  crypto     kallsyms     mounts       sys
11    1209  1286  1364  157   210   2666  33    49   712  913  968  devices    kcore        mpt          sysrq-trigger

```

那些以数字命名的目录存放着以该数字为PID的进程的信息。例如，/proc/1包含着进程init的信息，这个进程有内核在系统启动时创建的，是除了那个时候同时创建的几个内核进程之外的所有进程的父进程。

stat文件包含了进程的状态信息。